name: ğŸ” Run tests

on:
    push:
        branches: [main, production, develop]
        tags: ["v*.*.*"]
    pull_request:
        branches:
            - production
            - main
            - develop
    merge_group:
        branches:
            - production
            - main

jobs:
    test:
        runs-on: ubuntu-latest

        steps:
            - name: â¬‡ï¸ Checkout code
              uses: actions/checkout@v6

            - name: Â©ï¸ Copy container settings
              run: cp ./.docker/etc/settings_local.dev.py.example ./.docker/etc/settings_local.dev.py

            - name: ğŸ³ Set up Docker Compose
              uses: hoverkraft-tech/compose-action@v2.4.3
              with:
                  compose-file: docker-compose.debug.yml
                  up-flags: "--build -d"

            - name: ğŸ˜´ Let the services start
              uses: juliangruber/sleep-action@v2.0.3
              with:
                  time: 90s

            - name: ğŸ” Run tox
              run: docker compose exec api tox

    lint:
        runs-on: ubuntu-latest

        steps:
            - name: â¬‡ï¸ Checkout code
              uses: actions/checkout@v6

            - name: ğŸ‘Ÿ Run ruff
              uses: astral-sh/ruff-action@v3
              with:
                  src: "./apps"
